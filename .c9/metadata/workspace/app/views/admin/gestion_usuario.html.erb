{"filter":false,"title":"gestion_usuario.html.erb","tooltip":"/app/views/admin/gestion_usuario.html.erb","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":465,"column":0},"action":"remove","lines":["<% content_for :title, 'Usuarios' %>","<%= render partial: 'partial/cabecera', ","        locals: {cabecera: {","            titulo: 'Gestión de usuarios',","            navegacion: [","                {titulo: 'Inicio', ruta: root_path},","                {titulo: 'Usuarios', ruta: root_path}]","            }} %>","            ","    <div class=\"wrapper wrapper-content\">","        <div class=\"row\">","            <div class=\"col-lg-12\">","                <div class=\"ibox float-e-margins\">","                    <div class=\"ibox-content text-center p-md\">","                        ","                        <%= render partial: 'partial/boton_right', ","                                    locals: {botones: [","                                    {elemento: 'button', id: 'tab-usuario', clase: 'btn-warning', contenido: \"Usuario\"},","                                    {elemento: 'button', id: 'tab-trabajador', clase: 'btn-default', contenido: \"Trabajador\"}]} %>","                        <%= render partial: 'partial/boton_right', ","                                    locals: {botones: [","                                    {elemento: 'button', id: 'crear', clase: 'btn-primary', contenido: \"Usuario\"}]} %>","                      ","                        <div class=\"row\"></div>","                        <div id=\"contenedor_tabla_usuario\" class=\"table-responsive\">","                            <table id=\"dt_tabla_usuario\" class=\"table dt_tabla\">","                                <thead>","                                    <tr>","                                        <th></th>","                                        <th>Rol</th>","                                        <th>Cargo</th>","                                        <th>Nombre</th>","                                        <th>Apellido</th>","                                        <th>Identificación</th>","                                        <th>Correo</th>","                                        <th>Acción</th>","                                    </tr>","                                </thead>","                                <tbody>","                                </tbody>","                            </table>","                        </div>","                        <div id=\"contenedor_tabla_trabajador\" class=\"table-responsive\">","                            <table id=\"dt_tabla_trabajador\" class=\"table dt_tabla\">","                                <thead>","                                    <tr>","                                        <th></th>","                                        <th>Rol</th>","                                        <th>Cargo</th>","                                        <th>Nombre</th>","                                        <th>Apellido</th>","                                        <th>Identificación</th>","                                        <th>Correo</th>","                                        <th>Acción</th>","                                    </tr>","                                </thead>","                                <tbody>","                                </tbody>","                            </table>","                        </div>","","                    </div>","                </div>","            </div>","        </div>","    </div>","","<!-- NUEVO MODAL *************************************************** -->","    <div class=\"modal inmodal\" id=\"modal\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">","        <div class=\"modal-dialog modal-lg\">","            <div class=\"modal-content animated fadeIn\">","                <div class=\"modal-header\">","                    <h1>Nuevo usuario</h1>","                </div>","                <div class=\"modal-body\">","                    <div class=\"form-group\">","                        <form id=\"form\" action=\"#\" class=\"wizard-big\">","                            <h1>Datos básicos</h1>","                            <fieldset>","                                <h2>Datos personales del usuario</h2>","                                <div class=\"form-group \">","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                        <label class=\"col-sm-6 control-label\">Nombre</label>","                                        <input id=\"nombre\" type=\"text\" placeholder=\"Nombre\" class=\"form-control\">","                                    </div>","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                        <label class=\" control-label\">Apellido</label> ","                                        <input id=\"apellido\" type=\"text\" placeholder=\"Apellido\" class=\"form-control\">","                                    </div>           ","                                </div>","                                ","                                <div class=\"form-group\">","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                         <label class=\"col-sm-6 control-label\">Sexo</label>","                                        <select id=\"sexo\" data-placeholder=\"Sexo\" class=\"chosen-select form-control\" tabindex=\"2\" style=\"text-align: left;\">","                                            <option value=\"\"></option>","                                            <option value=\"Masculino\">Masculino</option>","                                            <option value=\"Femenino\">Femenino</option>","                                        </select>","                                    </div>","                                ","                                    <div class=\" col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                         <label class=\"col-sm-6 control-label\">Fecha de nacimiento</label>","                                        <input id=\"fechaNacimiento\" type=\"text\" placeholder=\"Fecha de Nacimiento\" class=\"form-control date\">","                                    </div>","                                </div>","                                <div class=\"form-group\">","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                        <label class=\"col-sm-6 control-label\">Identificación</label>","                                        <input id=\"identificacion\" type=\"text\" placeholder=\"Identificación\" class=\"form-control\">","                                    </div>","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                        <label class=\"col-sm-6 control-label\">Teléfono</label>","                                        <input id=\"telefono\" type=\"text\" placeholder=\"Teléfono\" class=\"form-control\">","                                    </div>","                                </div>","                                <div class=\"form-group\">","                                    <div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\">","                                        <label class=\"col-sm-6 control-label\">Dirección</label>","                                        <input id=\"direccion\" type=\"text\" placeholder=\"Dirección\" class=\"form-control\">","                                    </div>","                                </div>","                                                              ","                            </fieldset>","","                            <h1>Configuración de acceso</h1>","                            <fieldset>","                                <h2 align=\"center\">Configuración para acceso del usuario en OCELOT</h2>","","                                    <div class=\"hr-line-dashed\"></div>","                                    <div align=\"center\">","                                        <div class=\"form-group\">","                                            <div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\">","                                                <input id=\"correo\" type=\"text\" placeholder=\"Correo Electronico\" class=\"form-control\">","                                            </div>","                                        </div>","                                        <div class=\"form-group\">","                                            <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\" id=\"contenedorComboRol\">","                                                <select id=\"comboRol\" data-placeholder=\"Rol\" class=\"chosen-select form-control\" tabindex=\"2\" style=\"text-align: left;\">","                                                    <option value=\"\"></option>","                                                    <option value=\"Admin\">Admin</option>","                                                    <option value=\"Secretaria\">Secretaria</option>","                                                    <option value=\"Trabajador\">Trabajador</option>","                                                    <option value=\"Diagnosticador\">Diagnosticador</option>","                                                </select>","                                            </div>","                                            <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\" id=\"contenedorComboCargo\" style=\"visibility: hidden;\">","                                                <select id=\"comboCargo\" data-placeholder=\"Cargo\" class=\"chosen-select form-control\" tabindex=\"2\" style=\"text-align: left;\">","                                                    <option value=\"\"></option>","                                                    <option value=\"Jardinero\">Jardinero</option>","                                                    <option value=\"Albañil\">Albañil</option>","                                                    <option value=\"Carpintero\">Carpintero</option>","                                                </select>","                                            </div>","                                        </div>","                                    </div>","                                    ","                            </fieldset>","","                            <h1>Finalizar</h1>","                            <fieldset>","                                <h2>Registro de usuario finalizado</h2>","                                <br><br>","                                <label for=\"acceptTerms\">Si está seguro que los datos ingresados son correctos, pulse Terminar.</label>","                               ","                            </fieldset>","                        </form>                            ","                    </div>","                </div>","                <div class=\"modal-footer\">","                    <button type=\"button\" class=\"btn btn-default btn-fill\" data-dismiss=\"modal\"><i class=\"fa fa-close fa-fw\"></i>Cerrar</button>","                </div>","            </div>                                  ","        </div>","    </div> ","","<!-- FIN NUEVO MODAL ************************************************************** -->","","","<!-- MODAL BORRAR -->","<div class=\"modal inmodal\" id=\"modalBorrar\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">","    <div class=\"modal-dialog\">","        <div class=\"modal-content animated bounceInRight\">","            <div class=\"modal-header\">","                <button type=\"button\" class=\"close\" data-dismiss=\"modal\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>","                <h4 class=\"modal-title\"></h4>","                <!--<small class=\"font-bold\">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</small>-->","            </div>","            <div class=\"modal-body\">","","            <p id=\"eliminacion\"></p>","            </div>","","            <div class=\"modal-footer\">","                <button type=\"button\" class=\"btn btn-default btn-fill\" data-dismiss=\"modal\"><i class=\"fa fa-close fa-fw\"></i>Cerrar</button>","                <button id=\"btnBorrar\" type=\"button\" class=\"btn btn-danger btn-fill\"><i class=\"fa fa-edit-o fa-fw\"></i>Eliminar</button>","            </div>","        </div>","    </div>","</div>","<!-- /MODAL BORRAR -->","","<% content_for :javascript do %>","    <script type=\"text/javascript\">","    var tab = 'Usuario'; ","","    $(function() {","        cambiarTab();","        listar();","        datepicker();","        mark();","        agregar_row();","","        $('#contenedor_tabla_trabajador').hide();","    });","    var cambiarTab = function() {","        $( '#crear' ).html( '<i class=\"fa fa-plus fa-fw\"></i>Crear ' + tab );","","        $(document).on('click', '#tab-usuario', function() {","            cambiandoTab('Usuario', this, '#tab-trabajador', '#contenedor_tabla_usuario', '#contenedor_tabla_trabajador');","        });","","        $(document).on('click', '#tab-trabajador', function() {","            cambiandoTab('Trabajador', this, '#tab-usuario', '#contenedor_tabla_trabajador', '#contenedor_tabla_usuario');","        });","    }","    var cambiandoTab = function(tab_name, button_active, button_old, tabla_active, tabla_old) {","        tab = tab_name;","        $( button_old ).removeClass( \"btn-warning\" ).addClass( \"btn-default\" ); ","        $( button_active ).removeClass( \"btn-default\" ).addClass( \"btn-warning\" ); ","        $( tabla_active ).show();","        $( tabla_old ).hide();","        $( '#crear' ).html( '<i class=\"fa fa-plus fa-fw\"></i>Crear ' + tab );","        $( '#contenedorComboCargo' ).css('visibility', tab == 'Trabajador' ? 'visible' : 'hidden');","        $( '#path' ).html( 'Tabla de ' + tab );","    }","    var datepicker = function() {","        var dateToday = new Date();","        $('.date').datepicker({","            language: 'es',","            startView: 2,","            todayBtn: \"linked\",","            keyboardNavigation: false,","            forceParse: false,","            autoclose: true,","            minDate: 0","        });","    }","    var mark = function() {","        $(\"#telefono\").mask(\"(0000) 000-0000\");","        $(\".date\").mask(\"00/00/0000\");","    }","    var listar = function() {   ","        generarTabla('#dt_tabla_usuario', json_usuario);     ","        generarTabla('#dt_tabla_trabajador', json_trabajador);     ","    }","    var generarTabla = function(tabla, json) {","        var table = $(tabla).DataTable({","            bLengthChange : false,","            data: json,","            columnDefs: [","                { \"targets\": [ 2 ],\"visible\": tabla == '#dt_tabla_trabajador' },","            ],","            order: [[ 1, \"asc\" ]],","            columns: [","                { sortable: false,","                    \"render\": function ( data, type, full, meta ) {","                        var estatus = '';","                        switch(full.estatus) {","                            case 'A':","                                estatus = \"<button class='btn btn-primary btn-circle' data-toggle='tooltip' title='Activo' type='button'></button>\";","                            break;","                            case 'I':","                                estatus = \"<button class='btn btn-warning btn-circle' data-toggle='tooltip' title='Suspendido' type='button'></button>\";","                            break;","                        }","                    ","                        return estatus;","                    }","                },","                { data: \"rol\"},","                { data: \"cargo\"},","                { data: \"nombre\"},","                { data: \"apellido\"},","                { data: \"identificacion\"},","                { data: \"correo\"},","                { sortable: false,","                    \"render\": function ( data, type, full, meta ) {","                        var ver = \"<button type='button' class='ver btn btn-outline btn-default' data-toggle='tooltip' title='Ver Más'><i class='fa fa-eye'></i></button> \";","                        var editar = \"<button type='button' class='editar btn btn-outline btn-success' data-toggle='tooltip' title='Editar'><i class='fa fa-edit'></i></button> \";","                        var estatus_change = \"<button type='button' class='estatus_change btn btn-outline btn-warning' data-toggle='tooltip' title='Activar / Suspender'><i class='fa fa-refresh'></i></button> \";","                        var eliminar = \"<button type='button' class='eliminar btn btn-outline btn-danger' data-toggle='tooltip' title='Eliminar'><i class='fa fa-trash-o'></i></button>\";","                        return  ver + editar + estatus_change + eliminar;","                    }","                }","            ],","            language: data_table_language","        });","        ver_row(tabla + \" tbody\", table);","        editar_row(tabla + \" tbody\", table);","        eliminar_row(tabla + \" tbody\", table);","    }","    var agregar_row = function() {","        $(document).on('click', '#crear', function() {","            $(\"#btnSuccess\").html( '<i class=\"fa fa-save fa-fw\"></i> Guardar' );","            limpiarCampos('Nuevo ' + tab, 'inherit');","        });","    }","    var ver_row = function(tbody, table) {","        $(tbody).on('click', 'button.ver', function() {","            var data = table.row( $(this).parents(\"tr\") ).data();","            cargarCampos(data, 'Detalle ' + tab, 'none', true);","        });","    }","    var editar_row = function(tbody, table) {","        $(tbody).on('click', 'button.editar', function() {","            var data = table.row( $(this).parents(\"tr\") ).data();","            $(\"#btnSuccess\").html( '<i class=\"fa fa-edit fa-fw\"></i> Editar' );","            cargarCampos(data, 'Editar ' + tab, 'inherit', false);","        });","    }","    var eliminar_row = function(tbody, table) {","         $(tbody).on('click', 'button.eliminar', function() {","            var data = table.row( $(this).parents(\"tr\") ).data();","            $(\".modal-title\").html('Confirmación');","            $(\"#eliminacion\").html(\"¿Seguro desea eliminar a <b>\" + data.nombre + ' ' +  data.apellido + \"</b>?\");","            $('#modalBorrar').modal({ backdrop: 'static', keyboard: false });","        });","    }","    var cargarCampos = function(data, title, footerVisible, disable) {","        $(\"#comboRol\").val(data.rol).prop('disabled', disable).trigger(\"chosen:updated\");  ","        checkComboWhenIsTrabajador();      ","        $(\"#comboCargo\").val(data.cargo).prop('disabled', disable).trigger(\"chosen:updated\");","        $(\"#nombre\").val(data.nombre).prop('disabled', disable);","        $(\"#apellido\").val(data.apellido).prop('disabled', disable);","        $(\"#sexo\").val(data.sexo).prop('disabled', disable).trigger(\"chosen:updated\");","        var fecha = data.fecha_nacimiento.split(\"/\");","        $(\"#fechaNacimiento\").datepicker().datepicker(\"setDate\", new Date(parseInt(fecha[2]), parseInt(fecha[1]) - 1, parseInt(fecha[0]))).prop('disabled', disable).trigger('input');","        $(\"#identificacion\").val(data.identificacion).prop('disabled', disable);","        $(\"#telefono\").val(data.telefono).prop('disabled', disable).trigger('input');","        $(\"#correo\").val(data.correo).prop('disabled', disable);","        $(\"#direccion\").val(data.direccion).prop('disabled', disable);","        $(\".modal-footer\").css('display', footerVisible);","        $(\".modal-title\").html(title);","        $('#modal').modal({ backdrop: 'static', keyboard: false });","    }","    var limpiarCampos = function(title, footerVisible) {","        $(\"#comboRol\").val(tab == 'Trabajador' ? 'Trabajador' : '').prop('disabled', false).trigger(\"chosen:updated\");","        checkComboWhenIsTrabajador();     ","        $(\"#comboCargo\").val('').prop('disabled', false).trigger(\"chosen:updated\");","        $(\"#nombre\").val('').prop('disabled', false);","        $(\"#apellido\").val('').prop('disabled', false);","        $(\"#sexo\").val('').prop('disabled', false).trigger(\"chosen:updated\");","        $(\"#fechaNacimiento\").datepicker('setDate', null).prop('disabled', false);","        $(\"#identificacion\").val('').prop('disabled', false);","        $(\"#telefono\").val('').prop('disabled', false).trigger('input');","        $(\"#correo\").val('').prop('disabled', false);","        $(\"#direccion\").val('').prop('disabled', false);","        $(\".modal-footer\").css('display', footerVisible);","        $(\".modal-title\").html(title);","        $('#modal').modal({ backdrop: 'static', keyboard: false });","    }","    var checkComboWhenIsTrabajador = function() {","        if ($(\"#comboRol\").is(':enabled')) {","            $(\"#comboRol\").prop('disabled', tab == 'Trabajador').trigger(\"chosen:updated\");","        }","    }","","","    $(function() {","            $(\"#wizard\").steps();","            $(\"#form\").steps({","                labels: steps_language,","                bodyTag: \"fieldset\",","                onStepChanging: function (event, currentIndex, newIndex)","                {","                    // Always allow going backward even if the current step contains invalid fields!","                    if (currentIndex > newIndex)","                    {","                        return true;","                    }","","                    // Forbid suppressing \"Warning\" step if the user is to young","                    if (newIndex === 3 && Number($(\"#age\").val()) < 18)","                    {","                        return false;","                    }","","                    var form = $(this);","","                    // Clean up if user went backward before","                    if (currentIndex < newIndex)","                    {","                        // To remove error styles","                        $(\".body:eq(\" + newIndex + \") label.error\", form).remove();","                        $(\".body:eq(\" + newIndex + \") .error\", form).removeClass(\"error\");","                    }","","                    // Disable validation on fields that are disabled or hidden.","                    form.validate().settings.ignore = \":disabled,:hidden\";","","                    // Start validation; Prevent going forward if false","                    return form.valid();","                },","                onStepChanged: function (event, currentIndex, priorIndex)","                {","                    // Suppress (skip) \"Warning\" step if the user is old enough.","                    if (currentIndex === 2 && Number($(\"#age\").val()) >= 18)","                    {","                        $(this).steps(\"next\");","                    }","","                    // Suppress (skip) \"Warning\" step if the user is old enough and wants to the previous step.","                    if (currentIndex === 2 && priorIndex === 3)","                    {","                        $(this).steps(\"previous\");","                    }","                },","                onFinishing: function (event, currentIndex)","                {","                    var form = $(this);","","                    // Disable validation on fields that are disabled.","                    // At this point it's recommended to do an overall check (mean ignoring only disabled fields)","                    form.validate().settings.ignore = \":disabled\";","                    // Start validation; Prevent form submission if false","                    document.location.href = \"/gestion_usuario\"","                    //return form.valid();","                },","                onFinished: function (event, currentIndex)","                {","                    var form = $(this);","                        ","                    // Submit form input","                    form.submit();","                }","            }).validate({","                        errorPlacement: function (error, element)","                        {","                            element.before(error);","                        },","                        rules: {","                            confirm: {","                                equalTo: \"#password\"","                            }","                        }","                    });","                     $(function() {","        datePickerMultiple();","    });","    var datePickerMultiple = function() {","        $('.datex').datepicker({","            language: 'es',","            startView: 2,","            todayBtn: \"linked\",","            keyboardNavigation: false,","            forceParse: false,","            autoclose: true","        });","    }","       ","    ","       });","</script>","<% end %>",""],"id":2},{"start":{"row":0,"column":0},"end":{"row":498,"column":0},"action":"insert","lines":["<% content_for :title, 'Usuarios' %>","<%= render partial: 'partial/cabecera', ","        locals: {cabecera: {","            titulo: 'Gestión de usuarios',","            navegacion: [","                {titulo: 'Inicio', ruta: root_path},","                {titulo: 'Usuarios', ruta: root_path}]","            }} %>","            ","    <div class=\"wrapper wrapper-content\">","        <div class=\"row\">","            <div class=\"col-lg-12\">","                <div class=\"ibox float-e-margins\">","                    <div class=\"ibox-content text-center p-md\">","                        ","                        <%= render partial: 'partial/boton_right', ","                                    locals: {botones: [","                                    {elemento: 'button', id: 'tab-usuario', clase: 'btn-warning', contenido: \"Usuario\"},","                                    {elemento: 'button', id: 'tab-trabajador', clase: 'btn-default', contenido: \"Trabajador\"}]} %>","                        <%= render partial: 'partial/boton_right', ","                                    locals: {botones: [","                                    {elemento: 'button', id: 'crear', clase: 'btn-primary', contenido: \"Usuario\"}]} %>","                      ","                        <div class=\"row\"></div>","                        <div id=\"contenedor_tabla_usuario\" class=\"table-responsive\">","                            <table id=\"dt_tabla_usuario\" class=\"table dt_tabla\">","                                <thead>","                                    <tr>","                                        <th></th>","                                        <th>Rol</th>","                                        <th>Identificación</th>","                                        <th>Nombre</th>","                                        <th>Correo</th>","                                        <th>Acción</th>","                                    </tr>","                                </thead>","                                <tbody>","                                </tbody>","                            </table>","                        </div>","                        <div id=\"contenedor_tabla_trabajador\" class=\"table-responsive\">","                            <table id=\"dt_tabla_trabajador\" class=\"table dt_tabla\">","                                <thead>","                                    <tr>","                                        <th></th>","                                        <th>Cargo</th>","                                        <th>Identificación</th>","                                        <th>Nombre</th>","                                        <th>Correo</th>","                                        <th>Acción</th>","                                    </tr>","                                </thead>","                                <tbody>","                                </tbody>","                            </table>","                        </div>","","                    </div>","                </div>","            </div>","        </div>","    </div>","","<!-- NUEVO MODAL *************************************************** -->","    <div class=\"modal inmodal\" id=\"modal\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">","        <div class=\"modal-dialog modal-lg\">","            <div class=\"modal-content animated fadeIn\">","                <div class=\"modal-header\">","                    <h1>Nuevo usuario</h1>","                </div>","                <div class=\"modal-body\">","                    <div class=\"form-group\">","                        <form id=\"form\" action=\"#\" class=\"wizard-big\">","                            <h1>Datos básicos</h1>","                            <fieldset>","                                <h2>Datos personales del usuario</h2>","                                <div class=\"form-group \">","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                        <label class=\"col-sm-6 control-label\">Nombre Completo</label>","                                        <input id=\"nombre\" type=\"text\" placeholder=\"Nombre\" class=\"form-control\">","                                    </div>","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                        <label class=\"col-sm-6 control-label\">Identificación</label>","                                        <input id=\"identificacion\" type=\"text\" placeholder=\"Identificación\" class=\"form-control\">","                                    </div>         ","                                </div>","                                ","                                <div class=\"form-group\">","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                         <label class=\"col-sm-6 control-label\">Sexo</label>","                                        <select id=\"sexo\" data-placeholder=\"Sexo\" class=\"select form-control\" tabindex=\"2\" style=\"text-align: left;\">","                                            <option value=\"\"></option>","                                            <option value=\"M\">Masculino</option>","                                            <option value=\"F\">Femenino</option>","                                        </select>","                                    </div>","                                ","                                    <div class=\" col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                         <label class=\"col-sm-6 control-label\">Fecha de nacimiento</label>","                                        <input id=\"fechaNacimiento\" type=\"text\" placeholder=\"Fecha de Nacimiento\" class=\"form-control datex\">","                                    </div>","                                </div>","                                <div class=\"form-group\">                                    ","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                        <label class=\"col-sm-6 control-label\">Teléfono</label>","                                        <input id=\"telefono\" type=\"text\" placeholder=\"Teléfono\" class=\"form-control\">","                                    </div>","                                    <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\">","                                        <label class=\"col-sm-6 control-label\">Dirección</label>","                                        <input id=\"direccion\" type=\"text\" placeholder=\"Dirección\" class=\"form-control\">","                                    </div>","                                </div>                                                              ","                            </fieldset>","","                            <h1>Configuración de acceso</h1>","                            <fieldset>","                                <h2 align=\"center\">Configuración para acceso del usuario en OCELOT</h2>","","                                    <div class=\"hr-line-dashed\"></div>","                                    <div align=\"center\">","                                        <div class=\"form-group\">","                                            <div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\">","                                                <input id=\"correo\" type=\"text\" placeholder=\"Correo Electronico\" class=\"form-control\">","                                            </div>","                                        </div>","                                        <div class=\"form-group\">","                                            <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\" id=\"contenedorComboRol\">","                                                <select id=\"comboRol\" placeholder=\"Rol\" class=\"select form-control\" tabindex=\"2\" style=\"text-align: left;\">","                                                <%= @roles.try(:each) do |rol| %>","                                                <% if (rol.descripcion != \"Cliente\") %> ","                                                    <option value=\"<%= rol.id%>\"><%= rol.descripcion%></option>","                                                <% end %>","                                                <% end %>","                                                </select>","                                            </div>","                                            <div class=\"col-lg-6 col-md-6 col-sm-6 col-xs-6\" id=\"contenedorComboCargo\" style=\"visibility: hidden;\">","                                                <select id=\"comboCargo\" data-placeholder=\"Cargo\" class=\"select form-control\" tabindex=\"2\" style=\"text-align: left;\">","                                                    <%= @cargos.try(:each) do |cargo| %> ","                                                            <option value=\"<%= cargo.id%>\"><%= cargo.descripcion%></option>","                                                        <% end %>","                                                </select>","                                            </div>","                                        </div>","                                    </div>","                                    ","                            </fieldset>","","                            <h1>Finalizar</h1>","                            <fieldset>","                                <h2>Registro de usuario finalizado</h2>","                                <br><br>","                                <label for=\"acceptTerms\">Si está seguro que los datos ingresados son correctos, pulse Terminar.</label>","                               ","                            </fieldset>","                        </form>                            ","                    </div>","                </div>","                <div class=\"modal-footer\">","                <%= render partial: 'partial/boton_right', ","                    locals: {botones: [","                    {elemento: 'button', id: 'cerrar', clase: 'btn-default', contenido: \"Cerrar\"}]} %>","                </div>","            </div>                                  ","        </div>","    </div> ","","<!-- FIN NUEVO MODAL ************************************************************** -->","","","<!-- MODAL BORRAR -->","<div class=\"modal inmodal\" id=\"modalBorrar\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">","    <div class=\"modal-dialog\">","        <div class=\"modal-content animated bounceInRight\">","            <div class=\"modal-header\">","                <button type=\"button\" class=\"close\" data-dismiss=\"modal\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>","                <h4 class=\"modal-title\"></h4>","                <!--<small class=\"font-bold\">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</small>-->","            </div>","            <div class=\"modal-body\">","","            <p id=\"eliminacion\"></p>","            </div>","","            <div class=\"modal-footer\">","                <button type=\"button\" class=\"btn btn-default btn-fill\" data-dismiss=\"modal\"><i class=\"fa fa-close fa-fw\"></i>Cerrar</button>","                <button id=\"btnBorrar\" type=\"button\" class=\"btn btn-danger btn-fill\"><i class=\"fa fa-edit-o fa-fw\"></i>Eliminar</button>","            </div>","        </div>","    </div>","</div>","<!-- /MODAL BORRAR -->","","<% content_for :javascript do %>","    <script type=\"text/javascript\">","    var tab = 'Usuario'; ","","","    $(function() {","        cambiarTab();","        listar();","        datepicker();","        mark();","        agregar_row();","    });","    var cambiarTab = function() {","        $( '#crear' ).html( '<i class=\"fa fa-plus fa-fw\"></i>Crear ' + tab );","","        $(document).on('click', '#tab-usuario', function() {","            cambiandoTab('Usuario', this, '#tab-trabajador', '#contenedor_tabla_usuario', '#contenedor_tabla_trabajador');","        });","","        $(document).on('click', '#tab-trabajador', function() {","            cambiandoTab('Trabajador', this, '#tab-usuario', '#contenedor_tabla_trabajador', '#contenedor_tabla_usuario');","        });","    }","    var cambiandoTab = function(tab_name, button_active, button_old, tabla_active, tabla_old) {","        tab = tab_name;","        $( button_old ).removeClass( \"btn-warning\" ).addClass( \"btn-default\" ); ","        $( button_active ).removeClass( \"btn-default\" ).addClass( \"btn-warning\" ); ","        $( tabla_active ).show();","        $( tabla_old ).hide();","        $( '#crear' ).html( '<i class=\"fa fa-plus fa-fw\"></i>Crear ' + tab );","        $( '#contenedorComboCargo' ).css('visibility', tab == 'Trabajador' ? 'visible' : 'visible');","        $( '#path' ).html( 'Tabla de ' + tab );","    }","    var datepicker = function() {","        var dateToday = new Date();","        $('.date').datepicker({","            language: 'es',","            startView: 2,","            todayBtn: \"linked\",","            keyboardNavigation: false,","            forceParse: false,","            autoclose: true,","            minDate: 0","        });","    }","    var mark = function() {","        $(\"#telefono\").mask(\"(0000) 000-0000\");","        $(\".date\").mask(\"00/00/0000\");","    }","    var listar = function() {","        var json_usuario = <%=@datos.to_json.html_safe%>;","        var json_trabajador = <%=@datos1.to_json.html_safe%>;","        generarTabla('#dt_tabla_usuario', json_usuario);     ","        generarTabla('#dt_tabla_trabajador', json_trabajador);     ","    }","    var generarTabla = function(tabla, json) {","        var table = $(tabla).DataTable({","            bLengthChange : false,","            data: json,","            columnDefs: [","                { \"targets\": [ 2 ],\"visible\": tabla == '#dt_tabla_trabajador' },","            ],","            order: [[ 1, \"asc\" ]],","            columns: [","                { sortable: false,","                    \"render\": function ( data, type, full, meta ) {","                        var estatus = '';","                        switch(full.estatus) {","                            case 0:","                                estatus = \"<button class='btn btn-primary btn-circle' data-toggle='tooltip' title='Activo' type='button'></button>\";","                            break;","                            case 1:","                                estatus = \"<button class='btn btn-warning btn-circle' data-toggle='tooltip' title='Pendiente' type='button'></button>\";","                            break;","                            case 2:","                                estatus = \"<button class='btn btn-danger btn-circle' data-toggle='tooltip' title='Rechazado' type='button'></button>\";","                            break;","                        }","                        ","                        return estatus;","                    }","                },","                { data: \"rol_descripcion\"},","                { data: \"identificacion\"},","                { data: \"nombre\"},                ","                { data: \"email\"},","                { sortable: false,","                    \"render\": function ( data, type, full, meta ) {","                        var ver = \"<button type='button' class='ver btn btn-outline btn-default' data-toggle='tooltip' title='Ver Más'><i class='fa fa-eye'></i></button> \";","                        var editar = \"<button type='button' class='editar btn btn-outline btn-success' data-toggle='tooltip' title='Editar'><i class='fa fa-edit'></i></button> \";","                        var estatus_change = \"<button type='button' class='estatus_change btn btn-outline btn-warning' data-toggle='tooltip' title='Activar / Suspender'><i class='fa fa-refresh'></i></button> \";","                        var eliminar = \"<button type='button' class='eliminar btn btn-outline btn-danger' data-toggle='tooltip' title='Eliminar'><i class='fa fa-trash-o'></i></button>\";","                        return  ver + editar + estatus_change + eliminar;","                    }","                }","            ],","            language: data_table_language","        });","        ver_row(tabla + \" tbody\", table);","        editar_row(tabla + \" tbody\", table);","        eliminar_row(tabla + \" tbody\", table);","    }","    var agregar_row = function() {","        $(document).on('click', '#crear', function() {","            $(\"#btnSuccess\").html( '<i class=\"fa fa-save fa-fw\"></i> Guardar' );","            limpiarCampos('Nuevo ' + tab, 'inherit');","        });","    }","    var ver_row = function(tbody, table) {","        $(tbody).on('click', 'button.ver', function() {","            var data = table.row( $(this).parents(\"tr\") ).data();","            cargarCampos(data, 'Detalle ' + tab, 'none', true);","        });","    }","    var editar_row = function(tbody, table) {","        $(tbody).on('click', 'button.editar', function() {","            var data = table.row( $(this).parents(\"tr\") ).data();","            $(\"#btnSuccess\").html( '<i class=\"fa fa-edit fa-fw\"></i> Editar' );","            cargarCampos(data, 'Editar ' + tab, 'inherit', false);","        });","    }","    var eliminar_row = function(tbody, table) {","         $(tbody).on('click', 'button.eliminar', function() {","            var data = table.row( $(this).parents(\"tr\") ).data();","            $(\".modal-title\").html('Confirmación');","            $(\"#eliminacion\").html(\"¿Seguro desea eliminar a <b>\" + data.nombre + \"</b>?\");","            $('#modalBorrar').modal({ backdrop: 'static', keyboard: false });","        });","    }","    var cargarCampos = function(data, title, footerVisible, disable) {","        $(\"#comboRol\").val(data.rol).prop('disabled', disable);  ","        $(\"#comboCargo\").val(data.cargo).prop('disabled', disable);","        $(\"#nombre\").val(data.nombre).prop('disabled', disable);","        $(\"#sexo\").val(data.sexo).prop('disabled', disable);","        var fecha = data.fecha_de_nacimiento;","        $(\"#fechaNacimiento\").datepicker().datepicker(\"setDate\", new Date(parseInt(fecha[2]), parseInt(fecha[1]) - 1, parseInt(fecha[0]))).prop('disabled', disable).trigger('input');","        $(\"#identificacion\").val(data.identificacion).prop('disabled', disable);","        $(\"#telefono\").val(data.telefono).prop('disabled', disable).trigger('input');","        $(\"#correo\").val(data.email).prop('disabled', disable);","        $(\"#direccion\").val(data.direccion).prop('disabled', disable);","        $(\".modal-footer\").css('display', footerVisible);","        $(\".modal-title\").html(title);","        $('#modal').modal({ backdrop: 'static', keyboard: false });","    }","    var limpiarCampos = function(title, footerVisible) {","        $(\"#comboRol\").val(tab == 'Trabajador' ? 'Trabajador' : '').prop('disabled', false).trigger(\"chosen:updated\");","        $(\"#comboCargo\").val('').prop('disabled', false).trigger(\"chosen:updated\");","        $(\"#nombre\").val('').prop('disabled', false);","        $(\"#sexo\").val('').prop('disabled', false).trigger(\"chosen:updated\");","        $(\"#fechaNacimiento\").datepicker('setDate', null).prop('disabled', false);","        $(\"#identificacion\").val('').prop('disabled', false);","        $(\"#telefono\").val('').prop('disabled', false).trigger('input');","        $(\"#correo\").val('').prop('disabled', false);","        $(\"#direccion\").val('').prop('disabled', false);","        $(\".modal-footer\").css('display', footerVisible);","        $(\".modal-title\").html(title);","        $('#modal').modal({ backdrop: 'static', keyboard: false });","    }","    var checkComboWhenIsTrabajador = function() {","        if ($(\"#comboRol\").is(':enabled')) {","            $(\"#comboRol\").prop('disabled', tab == 'Trabajador').trigger(\"chosen:updated\");","        }","    }","","","    $(function() {","            $(\"#wizard\").steps();","            $(\"#form\").steps({","                labels: steps_language,","                bodyTag: \"fieldset\",","                onStepChanging: function (event, currentIndex, newIndex)","                {","                    // Always allow going backward even if the current step contains invalid fields!","                    if (currentIndex > newIndex)","                    {","                        return true;","                    }","","                    // Forbid suppressing \"Warning\" step if the user is to young","                    if (newIndex === 3 && Number($(\"#age\").val()) < 18)","                    {","                        return false;","                    }","","                    var form = $(this);","","                    // Clean up if user went backward before","                    if (currentIndex < newIndex)","                    {","                        // To remove error styles","                        $(\".body:eq(\" + newIndex + \") label.error\", form).remove();","                        $(\".body:eq(\" + newIndex + \") .error\", form).removeClass(\"error\");","                    }","","                    // Disable validation on fields that are disabled or hidden.","                    form.validate().settings.ignore = \":disabled,:hidden\";","","                    // Start validation; Prevent going forward if false","                    return form.valid();","                },","                onStepChanged: function (event, currentIndex, priorIndex)","                {","                    // Suppress (skip) \"Warning\" step if the user is old enough.","                    if (currentIndex === 2 && Number($(\"#age\").val()) >= 18)","                    {","                        $(this).steps(\"next\");","                    }","","                    // Suppress (skip) \"Warning\" step if the user is old enough and wants to the previous step.","                    if (currentIndex === 2 && priorIndex === 3)","                    {","                        $(this).steps(\"previous\");","                    }","                },","                onFinishing: function (event, currentIndex)","                {","                    var form = $(this);","","                    // Disable validation on fields that are disabled.","                    // At this point it's recommended to do an overall check (mean ignoring only disabled fields)","                    //form.validate().settings.ignore = \":disabled\";","                    // Start validation; Prevent form submission if false","                    var rol = $('#comboRol').val();","                    var cargo = $('#comboCargo').val();","                    if (cargo == null) {","                        var tipo = 1;","                    }else{","                        var tipo = 2;","                    }","","","                    var nombre = $('#nombre').val();","                    var sexo = $('#sexo').val();","                    var fechaNacimiento = $('#fechaNacimiento').val();","                    var identificacion = $('#identificacion').val();","                    var telefono = $('#telefono').val();","                    var direccion = $('#direccion').val();","                    var correo = $('#correo').val();","","                    var password = \"123\";","                    ","                $.ajax({","                        url:'/guardar_usuario',","                        data:{","                            nombre: nombre,","                            sexo: sexo,","                            fechaNacimiento: fechaNacimiento,","                            identificacion: identificacion,","                            telefono: telefono,","                            direccion: direccion,","                            correo: correo,","                            rol: rol,","                            cargo: cargo,","                            password: password,","                            tipo: tipo","                        },","                        success:function(data){","                            toastr.success(data.message);","                            $('#modal').modal('hide');","                            document.location.href = \"/gestion_usuario\"","                        },","                        error:function(data){","                            toastr.error(data.message, \"Oops!\");","                        }","                    });","                    ","                    return form.valid();","","","                },","                onFinished: function (event, currentIndex)","                {","                    var form = $(this);   ","                    // Submit form input","","                }","            }).validate({","                        errorPlacement: function (error, element)","                        {","                            element.before(error);","                        },","                        rules: {","                            confirm: {","                                equalTo: \"#password\"","                            }","                        }","                    });","                     $(function() {","        datePickerMultiple();","    });","    var datePickerMultiple = function() {","        $('.datex').datepicker({","            language: 'es',","            format: \"dd-mm-yyyy\",","            startView: 2,","            todayBtn: \"linked\",","            keyboardNavigation: false,","            forceParse: false,","            autoclose: true","        });","    }","       ","    ","       });","</script>","<% end %>",""]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":498,"column":0},"end":{"row":498,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":2,"state":"ruby-start","mode":"ace/mode/html_ruby"}},"timestamp":1512570574440,"hash":"0ad684cd3aea0d43bc276be43f11d5d0456824c0"}